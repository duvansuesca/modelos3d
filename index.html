<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Carro en tercera persona</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script>
      // 📌 Componente para que la cámara siga suavemente al carro
      AFRAME.registerComponent('third-person-camera', {
        schema: { target: { type: 'selector' } },
        tick: function () {
          if (!this.data.target) return;

          const targetPos = new THREE.Vector3();
          this.data.target.object3D.getWorldPosition(targetPos);

          const cameraPos = this.el.object3D.position;

          // 🎥 Posición de la cámara (detrás y arriba del carro)
          const desiredPos = new THREE.Vector3(
            targetPos.x,
            targetPos.y + 3,  // altura
            targetPos.z + 8   // distancia detrás
          );

          // 🔄 Movimiento suave (lerp)
          cameraPos.lerp(desiredPos, 0.1);

          // 👀 Cámara siempre mirando al carro
          this.el.object3D.lookAt(targetPos);
        }
      });
    </script>
  </head>
  <body>
    <a-scene>
      <!-- 🌌 Cielo -->
      <a-sky color="#88ccee"></a-sky>

      <!-- 💡 Luces -->
      <a-entity light="type: ambient; intensity: 1"></a-entity>
      <a-entity light="type: directional; intensity: 0.8" position="1 3 2"></a-entity>

      <!-- 🌍 Terreno -->
      <a-plane src="https://cdn.aframe.io/a-painter/images/floor.jpg" 
               rotation="-90 0 0" 
               width="200" height="200" 
               repeat="50 50">
      </a-plane>

      <!-- 🚗 Carro con controles -->
      <a-entity id="carRig" movement-controls="fly: false" wasd-controls="acceleration: 50">
        <a-entity id="maqueen"
                  gltf-model="url(modelos/maqueen.glb)" 
                  scale="1 1 1" 
                  position="0 0 0"
                  rotation="0 180 0">
        </a-entity>
      </a-entity>

      <!-- 📷 Cámara en tercera persona -->
      <a-entity camera third-person-camera="target: #maqueen"></a-entity>

    </a-scene>
  </body>
</html>
